webpackJsonp([4],{BbdB:function(e,s){},VcBQ:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=t("mvHQ"),r=t.n(a),i=t("Xxa5"),o=t.n(i),n=t("exGp"),l=t.n(n),c=t("Dd8w"),p=t.n(c),m=t("H/Zg"),u=t("6doq"),d=t("d+r2"),v=t("NYxO"),f=t("AezD"),b=t("lHQJ"),_=t("h+nM"),g=[],y={data:function(){return{columns:[{key:"email",label:"Email",sortable:!0,class:"text-center"},{key:"company.name",label:"CompaÃ±Ã­a",sortable:!0,sortDirection:"desc"},{key:"client.client_company_name",label:"Cliente",sortable:!0,class:"text-center"},{key:"profileType",label:"Perfil",sortable:!0,class:"text-center"},{key:"actions",label:"Acciones",class:"scaleWidth, text-center"}],currentPage:1,perPage:10,totalRows:g.length,parameters:d.a.parameters,pageOptions:d.a.pageOptions,sortBy:null,sortDesc:!1,sortDirection:"asc",filter:null,modalInfo:{title:"",visible:!1,mode:"create"},modalChangePassword:{title:"",visible:!1},items:[],user:{},modalErrors:[],clients_by_company:{}}},computed:p()({sortOptions:function(){return this.columns.filter(function(e){return e.sortable}).map(function(e){return{text:e.label,value:e.key}})}},Object(v.b)(["companies","clients","isAdmin","isCompany","profile","currentUser","isCompany"])),created:function(){var e=this;return l()(o.a.mark(function s(){return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e.refreshData(),e.user=e.clearObj();case 2:case"end":return s.stop()}},s,e)}))()},mounted:function(){this.$store.commit(f.a)},methods:{isVisible:function(e){return!!("companies"===e&&this.isAdmin&&this.user.profileType>1)||(!!("cliente"===e&&(this.isAdmin||this.isClient)&&this.user.profileType>2)||(!("profileType"!==e||!this.isAdmin)||"password"===e&&("create"===this.modalInfo.mode||"changePassword"===this.modalInfo.mode)))},profileName:function(e){switch(e){case 1:return u.a.tc("message.administrador");case 2:return u.a.tc("message.compania");case 3:return u.a.tc("message.cliente")}},process:function(e,s,t){var a=this;return l()(o.a.mark(function s(){var i;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=null,a.$store.commit(f.a),a.modalErrors=[],a.$store.commit(f.k,!0),"edit"===t.id?(a.user=JSON.parse(r()(e)),a.modalInfo.title=u.a.tc("message.edit"),a.modalInfo.mode="edit",i=a.user.company_id,a.isVisible("cliente")&&a.consultClients(i)):"create"===t.id?(a.user=a.clearObj(),a.modalInfo.mode="create",a.modalInfo.title=u.a.tc("message.create"),i=a.currentUser.company_id):"changePassword"===t.id&&(a.user=JSON.parse(r()(e)),a.modalInfo.mode="changePassword",a.modalInfo.title=u.a.tc("message.change_password"),a.$root.$emit("bv::show::modal","modalChangePassword")),!a.isAdmin){s.next=16;break}return s.prev=6,s.next=9,a.$store.dispatch(b.e);case 9:s.next=14;break;case 11:s.prev=11,s.t0=s.catch(6),a.modalErrors.push(s.t0.message);case 14:s.next=17;break;case 16:a.isCompany&&a.consultClients(i);case 17:a.modalInfo.visible=!0,a.$root.$emit("bv::show::modal","modalInfo",t);case 19:case"end":return s.stop()}},s,a,[[6,11]])}))()},consultClients:function(e){var s=this;return l()(o.a.mark(function t(){var a,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s.$store.commit(f.k,!0),(a={}).idCompany=e,a.isAdmin=s.isAdmin,a.isCompany=s.isCompany,t.next=8,m.a.post(a,d.a.endPoints.urlClients);case 8:i=t.sent,s.clients_by_company=i.data,s.modalErrors=[],s.$store.commit(f.k,!1),t.next=19;break;case 14:t.prev=14,t.t0=t.catch(0),console.error(r()(t.t0.message)),s.modalErrors.push(t.t0.message),s.$store.commit(f.k,!1);case 19:case"end":return t.stop()}},t,s,[[0,14]])}))()},changeCompany:function(e){this.consultClients(e)},clearObj:function(){var e={id:null,email:null,company:null,company_id:null,client_id:null,password:null,profileType:null};return this.isCompany&&(e.company=this.currentUser.company,e.company_id=this.currentUser.company_id,e.profileType=_.b),e},resetModalInfo:function(){this.modalInfo.title=""},onFiltered:function(e){this.totalRows=e.length,this.currentPage=1},refreshData:function(){var e=this;return l()(o.a.mark(function s(){var t,a;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,e.$store.commit(f.k,!0),e.clearObj(),t={},e.isAdmin?t.idCompany=null:e.isCompany&&(t.idCompany=e.currentUser.company_id),t.isAdmin=e.isAdmin,t.isCompany=e.isCompany,s.next=9,m.a.post(t,d.a.endPoints.usersByCompany);case 9:200===(a=s.sent).status?e.items=a.data:e.items=[],s.next=16;break;case 13:s.prev=13,s.t0=s.catch(0),e.$store.commit(f.j,s.t0.message);case 16:e.$store.commit(f.k,!1);case 17:case"end":return s.stop()}},s,e,[[0,13]])}))()},onSubmit:function(e){var s=this;e.preventDefault(),this.$validator.validate().then(function(e){e&&(s.user.username=s.user.email,s.save(s.user,d.a.endPoints.users))})},save:function(e,s){var t=this;return l()(o.a.mark(function a(){var r;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,r=null,!e.id||0===e.id){a.next=8;break}return a.next=5,m.a.update(e.id,e,s);case 5:r=a.sent,a.next=11;break;case 8:return a.next=10,m.a.create(e,s);case 10:r=a.sent;case 11:if(!(r.status>=200&&r.status<=300)){a.next=16;break}return alert(u.a.tc("message.guardar_modificar_exito")),a.next=15,t.refreshData();case 15:t.modalInfo.visible=!1;case 16:a.next=21;break;case 18:a.prev=18,a.t0=a.catch(0),t.modalErrors.push(a.t0.message);case 21:case"end":return a.stop()}},a,t,[[0,18]])}))()},remove:function(e){var s=this;return l()(o.a.mark(function t(){var a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!confirm(u.a.tc("message.confirm_delete_message"))){t.next=14;break}return t.prev=1,t.next=4,m.a.remove(e,d.a.endPoints.users);case 4:if(!((a=t.sent).status>=200&&a.status<=300)){t.next=9;break}return alert(u.a.tc("message.eliminar_exito")),t.next=9,s.refreshData();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),s.$store.commit(f.j,t.t0.message);case 14:case"end":return t.stop()}},t,s,[[1,11]])}))()}}},h=t("XyMi");var w=function(e){t("BbdB")},x=Object(h.a)(y,function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("b-container",{attrs:{fluid:""}},[t("b-card",[t("b-row",[t("b-col",{staticClass:"my-1",attrs:{md:"6"}},[t("b-form-group",{staticClass:"mb-0",attrs:{horizontal:"",label:e.$t("message.filtro")}},[t("b-input-group",[t("b-form-input",{attrs:{placeholder:e.$t("message.type_to_search")},model:{value:e.filter,callback:function(s){e.filter=s},expression:"filter"}}),e._v(" "),t("b-input-group-append",[t("b-btn",{attrs:{disabled:!e.filter},on:{click:function(s){e.filter=""}}},[e._v(e._s(e.$t("message.clear")))])],1)],1)],1)],1),e._v(" "),t("b-col",{staticClass:"my-1",attrs:{md:"6"}},[t("b-form-group",{staticClass:"mb-0",attrs:{horizontal:"",label:e.$t("message.sort")}},[t("b-input-group",[t("b-form-select",{attrs:{options:e.sortOptions},model:{value:e.sortBy,callback:function(s){e.sortBy=s},expression:"sortBy"}},[t("option",{attrs:{slot:"first"},domProps:{value:null},slot:"first"},[e._v("-- -- --")])]),e._v(" "),t("b-form-select",{attrs:{slot:"append",disabled:!e.sortBy},slot:"append",model:{value:e.sortDesc,callback:function(s){e.sortDesc=s},expression:"sortDesc"}},[t("option",{domProps:{value:!1}},[e._v("Asc")]),e._v(" "),t("option",{domProps:{value:!0}},[e._v("Desc")])])],1)],1)],1)],1),e._v(" "),t("b-row",[t("b-col",{staticClass:"my-1",attrs:{md:"6"}},[t("b-form-group",{staticClass:"mb-0",attrs:{horizontal:"",label:e.$t("message.peer_page")}},[t("b-form-select",{attrs:{options:e.pageOptions},model:{value:e.perPage,callback:function(s){e.perPage=s},expression:"perPage"}})],1)],1)],1)],1),e._v(" "),t("b-card",{staticClass:"card-body"},[t("b-row",[t("b-col",[t("b-button",{staticClass:"float-right my-1",attrs:{type:"submit",size:"m",variant:"primary",id:"create"},on:{click:function(s){s.stopPropagation(),e.process(null,null,s.target)}}},[t("i",{staticClass:"fa icon-plus"}),e._v(" "+e._s(e.$t("message.create"))+"\n      ")])],1)],1),e._v(" "),t("b-row",[t("b-col",{attrs:{md:"12"}},[t("b-table",{attrs:{"show-empty":"",hover:"",stacked:"sm",items:e.items,fields:e.columns,"current-page":e.currentPage,"per-page":e.perPage,filter:e.filter,"sort-by":e.sortBy,"sort-desc":e.sortDesc,"sort-direction":e.sortDirection,emptyText:e.$t("message.no_resultados"),emptyFilteredText:e.$t("message.no_data_filter"),responsive:""},on:{"update:sortBy":function(s){e.sortBy=s},"update:sortDesc":function(s){e.sortDesc=s},filtered:e.onFiltered},scopedSlots:e._u([{key:"name",fn:function(s){return[e._v(e._s(s.value.first)+" "+e._s(s.value.last))]}},{key:"client_company_name",fn:function(s){return[e._v(e._s(s.value?s.value:"--"))]}},{key:"profileType",fn:function(s){return[e._v("\n          "+e._s(e.profileName(s.value))+"\n        ")]}},{key:"actions",fn:function(s){return[t("b-button",{attrs:{size:"sm",id:"edit"},on:{click:function(t){t.stopPropagation(),e.process(s.item,s.index,t.target)}}},[e._v("\n            "+e._s(e.$t("message.edit"))+"\n          ")]),e._v(" "),t("b-button",{attrs:{size:"sm",id:"changePassword",variant:"secondary"},on:{click:function(t){t.preventDefault(),e.process(s.item,s.index,t.target)}}},[e._v("\n            "+e._s(e.$t("message.change_password"))+"\n          ")]),e._v(" "),t("b-button",{attrs:{size:"sm",id:"remove",variant:"danger"},on:{click:function(t){t.preventDefault(),e.remove(s.item.id)}}},[e._v("\n            "+e._s(e.$t("message.delete"))+"\n          ")])]}},{key:"row-details",fn:function(s){return[t("b-card",[t("ul",e._l(s.item,function(s,a){return t("li",{key:a},[e._v(e._s(a)+": "+e._s(s))])}))])]}}])})],1)],1),e._v(" "),t("b-row",[t("b-col",{staticClass:"my-1",attrs:{md:"6"}},[t("b-pagination",{staticClass:"my-0",attrs:{"total-rows":e.totalRows,"per-page":e.perPage},model:{value:e.currentPage,callback:function(s){e.currentPage=s},expression:"currentPage"}})],1)],1)],1),e._v(" "),t("b-modal",{directives:[{name:"show",rawName:"v-show",value:e.modalInfo.visible,expression:"modalInfo.visible"}],ref:"modalCreateUpdate",attrs:{id:"modalInfo",title:e.modalInfo.title,lazy:""},on:{hide:e.resetModalInfo,ok:e.onSubmit}},[t("b-alert",{attrs:{show:e.modalErrors.length>0,variant:"danger"}},[t("ul",{staticClass:"error-messages"},e._l(e.modalErrors,function(s,a){return t("li",{key:a},[e._v("\n            "+e._s(s)+"\n          ")])}))]),e._v(" "),t("form",{on:{submit:function(s){return s.preventDefault(),e.onSubmit(s)}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:"create"===e.modalInfo.mode||"edit"===e.modalInfo.mode,expression:"modalInfo.mode === 'create' || modalInfo.mode === 'edit'"}]},[t("b-input-group",{directives:[{name:"show",rawName:"v-show",value:e.isVisible("profileType"),expression:"isVisible('profileType')"}],staticClass:"mb-3"},[t("b-input-group-prepend",[t("b-input-group-text",[t("i",{staticClass:"icon-grid"})])],1),e._v(" "),t("b-form-select",{directives:[{name:"validate",rawName:"v-validate",value:e.isVisible("profileType")?"required":"",expression:"isVisible('profileType')?'required':''"}],attrs:{name:"profileType",id:"profileType",options:e.parameters.profiles},model:{value:e.user.profileType,callback:function(s){e.$set(e.user,"profileType",s)},expression:"user.profileType"}},[t("template",{slot:"first"},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("message.seleccion_perfil")))])])],2),e._v(" "),e.errors.has("profileType")?t("p",{staticClass:"text-danger"},[e._v(e._s(e.errors.first("profileType")))]):e._e()],1),e._v(" "),t("b-input-group",{directives:[{name:"show",rawName:"v-show",value:e.isVisible("companies"),expression:"isVisible('companies')"}],staticClass:"mb-3"},[t("b-input-group-prepend",[t("b-input-group-text",[t("i",{staticClass:"icon-grid"})])],1),e._v(" "),t("b-form-select",{directives:[{name:"validate",rawName:"v-validate",value:e.isVisible("companies")?"required":"",expression:"isVisible('companies')?'required':''"}],attrs:{name:"companies",id:"companies",options:e.companies,"value-field":"id","text-field":"name"},on:{change:e.changeCompany},model:{value:e.user.company_id,callback:function(s){e.$set(e.user,"company_id",s)},expression:"user.company_id"}},[t("template",{slot:"first"},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("message.seleccion_compania")))])])],2),e._v(" "),e.errors.has("companies")?t("p",{staticClass:"text-danger"},[e._v(e._s(e.errors.first("companies")))]):e._e()],1),e._v(" "),t("b-input-group",{directives:[{name:"show",rawName:"v-show",value:e.isVisible("cliente"),expression:"isVisible('cliente')"}],staticClass:"mb-3"},[t("b-input-group-prepend",[t("b-input-group-text",[t("i",{staticClass:"icon-grid"})])],1),e._v(" "),t("b-form-select",{directives:[{name:"validate",rawName:"v-validate",value:e.isVisible("cliente")?"required":"",expression:"isVisible('cliente')?'required':''"}],attrs:{name:"cliente",id:"cliente",options:e.clients_by_company,"text-field":"client_company_name"},model:{value:e.user.client_id,callback:function(s){e.$set(e.user,"client_id",s)},expression:"user.client_id"}},[t("template",{slot:"first"},[t("option",{domProps:{value:null}},[e._v(e._s(e.$t("message.seleccion_cliente")))])])],2),e._v(" "),e.errors.has("cliente")?t("p",{staticClass:"text-danger"},[e._v(e._s(e.errors.first("cliente")))]):e._e()],1),e._v(" "),t("b-input-group",{staticClass:"mb-3"},[t("b-input-group-prepend",[t("b-input-group-text",[t("i",{staticClass:"icon-user"})])],1),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.user.email,expression:"user.email"},{name:"validate",rawName:"v-validate",value:"required|email",expression:"'required|email'"}],staticClass:"form-control",attrs:{type:"text",placeholder:e.$t("message.email"),name:"email",id:"email",autocomplete:"email"},domProps:{value:e.user.email},on:{input:function(s){s.target.composing||e.$set(e.user,"email",s.target.value)}}}),e._v(" "),e.errors.has("email")?t("p",{staticClass:"text-danger"},[e._v(e._s(e.errors.first("email")))]):e._e()],1)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isVisible("password"),expression:"isVisible('password')"}]},[t("b-input-group",{staticClass:"mb-3"},[t("b-input-group-prepend",[t("b-input-group-text",[t("i",{staticClass:"icon-lock"})])],1),e._v(" "),t("input",{directives:[{name:"validate",rawName:"v-validate",value:e.isVisible("password")?"required|min:8":"",expression:"isVisible('password')?'required|min:8': ''"},{name:"model",rawName:"v-model",value:e.user.password,expression:"user.password"}],ref:"password",staticClass:"form-control",attrs:{name:"password",type:"password",placeholder:e.$t("message.pwd")},domProps:{value:e.user.password},on:{input:function(s){s.target.composing||e.$set(e.user,"password",s.target.value)}}}),e._v(" "),e.errors.has("password")?t("p",{staticClass:"text-danger"},[e._v(e._s(e.errors.first("password")))]):e._e()],1),e._v(" "),t("b-input-group",{staticClass:"mb-4"},[t("b-input-group-prepend",[t("b-input-group-text",[t("i",{staticClass:"icon-lock"})])],1),e._v(" "),t("input",{directives:[{name:"validate",rawName:"v-validate",value:e.isVisible("password")?"required|confirmed:password":"",expression:"isVisible('password')?'required|confirmed:password':''"}],staticClass:"form-control",attrs:{type:"password",name:"verificarPassword",placeholder:e.$t("message.repeatPwd"),"data-vv-as":"password"}}),e._v(" "),e.errors.has("verificarPassword")?t("p",{staticClass:"text-danger"},[e._v(e._s(e.errors.first("verificarPassword")))]):e._e()],1)],1)])],1)],1)},[],!1,w,"data-v-278f12ec",null);s.default=x.exports}});
//# sourceMappingURL=4.ef0703c76b024a89f060.js.map